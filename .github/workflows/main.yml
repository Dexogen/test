name: Publish new packages.

# Controls when the action will run.
on:
  # Triggers the workflow on push events but only for the master branch
  push:
    branches: [ main ]

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  # This workflow contains a single job called "build"
  publish:
    # The type of runner that the job will run on
    runs-on: ubuntu-latest

    # Steps represent a sequence of tasks that will be executed as part of the job
    steps:
      # Runs a single command using the runners shell
      - uses: arkane-systems/apt-repo-update@v1.1
        with:
          debug: false
          github_token: ${{ secrets.PAT }}
          repo_supported_arch: |
            arm64
          repo_supported_distro: |
            bookworm
          private_key: ${{ secrets.PRIVATE }}
          key_passphrase: ${{ secrets.SECRET }}



# # yamllint disable rule:truthy
# on: [push]
# #  release:
# #    types:
# #      - published

# permissions:
#   contents: read
#   pages: write
#   id-token: write

# env:
#   REPO_NAME: test
#   CODENAME: bookworm
#   COMPONENTS: main
#   ARCHITECTURES: arm64

# jobs:
#   build:
#     runs-on: ubuntu-latest
#     outputs:
#       artifact_id: ${{ steps.upload-artifact.outputs.artifact-id }}
#       keyring: ${{ steps.create-apt-repo.outputs.keyring }}
#     steps:
#       - name: Checkout code
#         uses: actions/checkout@v4
#       - name: Setup Pages
#         uses: actions/configure-pages@v4
#       - name: Create packages
#         uses: robinraju/release-downloader@v1.10
#         with:
#           repository: 'wofferl/proxmox-backup-arm64'
#           latest: true
#           fileName: '*.deb'
#       - uses: morph027/apt-repo-action@v2
#         id: create-apt-repo
#         with:
#           repo-name: ${{ env.REPO_NAME }}
#           signing-key: ${{ secrets.SIGNING_KEY }}
#           codename: ${{ env.CODENAME }}
#           components: ${{ env.COMPONENTS }}
#           architectures: ${{ env.ARCHITECTURES }}
#       - name: Upload Pages artifact
#         uses: actions/upload-pages-artifact@v3
#         with:
#           name: github-pages
#           path: ${{ steps.create-apt-repo.outputs.dir }}
#   deploy:
#     environment:
#       name: github-pages
#       url: ${{ steps.deployment.outputs.page_url }}
#     runs-on: ubuntu-latest
#     needs: build
#     steps:
#       - name: Deploy to GitHub Pages
#         id: deployment
#         uses: actions/deploy-pages@v4
#       - name: Adding summary
#         run: |
#           echo ':rocket:' >> $GITHUB_STEP_SUMMARY
#           echo '' >> $GITHUB_STEP_SUMMARY
#           echo '```bash' >> $GITHUB_STEP_SUMMARY
#           echo 'curl -sfLo /etc/apt.trusted.gpg.d/${{ needs.build.outputs.keyring }}.asc ${{ steps.deploy-pages.outputs.page_url }}gpg.key' >> $GITHUB_STEP_SUMMARY
#           echo 'echo "deb ${{ steps.deploy-pages.outputs.page_url }} ${{ env.CODENAME }} ${{ env.COMPONENTS }}" >/etc/apt/sources.list.d/${{ env.REPO_NAME }}.list' >> $GITHUB_STEP_SUMMARY
#           echo '```' >> $GITHUB_STEP_SUMMARY
